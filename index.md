# index.md（导读与目录）

* 0.1 本书定位与读者画像（AI Scientist / 中型企业 Infra 工程师）
* 0.2 技术范围与交付物（多模自回归、大规模预训练 checkpoint）
* 0.3 全局系统图（数据→治理→离散化→混采→训练→评测→交付）
* 0.4 两档生产方案概览：**1B** 与 **10B**（算力、成本、时长、风险）
* 0.5 贯穿式时间线与里程碑（24–40 周总览）
* 0.6 术语、符号与记号约定（含多模 token 记号）
* 0.7 如何使用本书与复现清单
* 0.8 本章小结
* 0.9 常见陷阱与错误（Gotchas）

---

# chapter1.md — 总览与技术路线

* 1.1 开篇与学习目标
* 1.2 任务定义与边界（自回归、多模态、早期融合）
* 1.3 架构路线比较：早期融合 vs 后期融合；Dense vs MoE
* 1.4 统一离散化视角：文本/图像/音频/视频→离散 token
* 1.5 训练目标与损失函数（NLL/CE、可选辅助任务）
* 1.6 规模分档：1B / 10B /（参考）30B 的工程差异
* 1.7 端到端数据流与控制面（ASCII 系统图）
* 1.8 经验法则（Rule-of-Thumb）与容量预估速表
* 1.9 本章小结
* 1.10 常见陷阱与错误

# chapter2.md — 项目管理与里程碑

* 2.1 开篇与学习目标
* 2.2 组织与角色分工（数据、离散化、模型、Infra、评测、法务）
* 2.3 时间线（周粒度）：准备→P0 演示→Alpha→Beta→Freeze→Release
* 2.4 Go/No-Go 门槛与风险清单（技术/合规/成本）
* 2.5 成本与预算模型（算力/存储/带宽/人工）
* 2.6 依赖矩阵与供应链（H100、NVLink、并行通信、对象存储）
* 2.7 交付物与里程碑验收标准
* 2.8 本章小结
* 2.9 常见陷阱与错误

# chapter3.md — 数据配方设计（100T token 池）

* 3.1 开篇与学习目标
* 3.2 模态/语言/域目标配比（中英 90%、其他语种 10%）
* 3.3 Token 预算到数据集分解方法（按数据集逐项分配）
* 3.4 课程与退火：分阶段采样与温度调度
* 3.5 质量分层与权重（A/B/C 层与重采样策略）
* 3.6 开源语料与自采的组合策略（“尽量复用别人洗好的包”）
* 3.7 合成数据的角色与比例（文本/音频/视频补齐长尾）
* 3.8 数据版本化与数据卡（Data Card / 许可证跟踪）
* 3.9 本章小结
* 3.10 常见陷阱与错误

# chapter4.md — 文本数据：抓取、清洗、去重与质量分层

* 4.1 开篇与学习目标
* 4.2 数据来源与合规（维基、书籍、新闻、网页、论坛等）
* 4.3 抓取与解析（爬虫策略、动态页面、robots.txt 遵循）
* 4.4 语言识别与分布控制（fastText / cld3 等）
* 4.5 质量过滤：**fastText** 主题/语言、**小模型** 因果困惑度过滤、毒性/PII
* 4.6 去重：Exact / Near-dup（MinHash/SimHash、跨语种归并）
* 4.7 Token 化、长度分布与长序列采样
* 4.8 数据集级 token 预算与表格（逐集分配占比）
* 4.9 本章小结
* 4.10 常见陷阱与错误

# chapter5.md — 音频数据：合规抓取、ASR 对齐、RVQ 离散化

* 5.1 开篇与学习目标
* 5.2 来源与许可（播客/演讲/有声书/YouTube-音轨）
* 5.3 抓取与切分（VAD、静音/噪声过滤、采样率/比特率）
* 5.4 ASR 转写与对齐（词级/句级时间戳、双语字幕）
* 5.5 质量评估：SNR、WER、说话人分离/聚类
* 5.6 离散化：Encodec / 音频 VQ-VAE + **多级 RVQ**（码率与 token/秒）
* 5.7 过滤：小模型音频分类（脏话、广告、音乐占比）
* 5.8 合成音频：TTS/TTS-StyleMix 与比例控制
* 5.9 Token 预算与存储搬运成本（IO/冷存/热存）
* 5.10 本章小结
* 5.11 常见陷阱与错误

# chapter6.md — 视频数据：合规抓取、切片、时空离散化

* 6.1 开篇与学习目标
* 6.2 来源与许可（YouTube/学术/CC 库），字幕/元数据抓取
* 6.3 镜头切分与采样（fps、关键帧、Tubelet）
* 6.4 音轨/字幕抽取、OCR 与语义对齐
* 6.5 离散化：视频 VQ + **RVQ**（帧块码本、token/秒）
* 6.6 质量过滤：模糊/水印/重片段/无关内容
* 6.7 存储与搬运成本模型（TB/小时、分层存储、预取）
* 6.8 合成视频与数据扩增（可选）
* 6.9 Token 预算与课程调度（短视频 vs 长视频）
* 6.10 本章小结
* 6.11 常见陷阱与错误

# chapter7.md — 图像数据：采集、质量打分与离散化

* 7.1 开篇与学习目标
* 7.2 ALT/TEXT 配对与文本相关性
* 7.3 审美/主体性/可读性评分（小模型质量打分）
* 7.4 去重（感知哈希/CLIP 向量近重）
* 7.5 离散化：dVAE/VQGAN/VQ-VAE（典型 16×16 latent → ~256 token/图）
* 7.6 Token 预算、分辨率与裁切策略
* 7.7 数据卡与版权标注
* 7.8 本章小结
* 7.9 常见陷阱与错误

# chapter8.md — Tokenizer 与词表：多模扩词、特殊符与对齐

* 8.1 开篇与学习目标
* 8.2 文本沿用 **Qwen tokenizer** 的多模扩展
* 8.3 模态特殊符与段标记（<img>, <aud>, <vid>, <seg> 等）
* 8.4 连续特征编码器 + **RVQ** 的码本并入统一词表
* 8.5 时间/空间位置编码与对齐标注（帧/块/时间戳）
* 8.6 长上下文对齐与分块拼接策略
* 8.7 样本串联与 Packing 规范（多模混拼）
* 8.8 词表版本化与兼容性
* 8.9 本章小结
* 8.10 常见陷阱与错误

# chapter9.md — 模型结构与超参数（1B/7B/10B/14B/30B）

* 9.1 开篇与学习目标
* 9.2 类 Qwen 的 **dense decoder-only** 主体（早期融合输入）
* 9.3 关键模块：RoPE、RMSNorm、SwiGLU、KV Cache
* 9.4 尺度配置表：**1B** 与 **10B**（层数/隐藏维/头数/上下文）
* 9.5 位置编码多模对齐与段间屏蔽
* 9.6 优化器与正则（AdamW、权重衰减、Dropout、Label Smoothing）
* 9.7 训练稳定性技巧（学习率、Warmup、Cosine、Grad Clip）
* 9.8 推理与 KV 内存估算（不同上下文与 batch）
* 9.9 本章小结
* 9.10 常见陷阱与错误

# chapter10.md — 训练基础设施（Megatron @ 256×H100）

* 10.1 开篇与学习目标
* 10.2 并行切分：TP/PP/DP/SP/CP 推荐组合
* 10.3 精度与内存：BF16/FP8、Activation Checkpointing、ZeRO
* 10.4 通信与拓扑：NVLink/NVSwitch、IB/NIC 亲和
* 10.5 数据输入与高吞吐 IO（WebDataset/TFRecord/Record I/O）
* 10.6 调度与容错（流水线级重启、断点续训、Checkpointer）
* 10.7 性能剖析：吞吐、利用率、重算比例
* 10.8 安全与权限（密钥、凭证、桶策略）
* 10.9 本章小结
* 10.10 常见陷阱与错误

# chapter11.md — 数据混采与课程策略（10T token 单轮）

* 11.1 开篇与学习目标
* 11.2 模态/语言/域的采样温度与退火计划
* 11.3 长序列比例与上下文扩展课程
* 11.4 多模拼接与 Mask 规则（段间屏蔽、跨模对齐）
* 11.5 去重后再采样与新鲜度控制
* 11.6 在线质量重加权（loss-based reweighting）
* 11.7 本章小结
* 11.8 常见陷阱与错误

# chapter12.md — 监控与可观测性

* 12.1 开篇与学习目标
* 12.2 训练侧指标：吞吐、稳定性、损失、显存/通信
* 12.3 数据侧指标：覆盖度、重复率、PII/性率、语言/模态占比
* 12.4 离散化流水线监控（码率、丢帧、RVQ 码本利用率）
* 12.5 告警与回滚策略（数据/模型双向熔断）
* 12.6 自动评测与回归检测
* 12.7 本章小结
* 12.8 常见陷阱与错误

# chapter13.md — 评测体系（AR Perplexity & VL 指标）

* 13.1 开篇与学习目标
* 13.2 文本自回归困惑度（分域/分语种）
* 13.3 音频自回归困惑度（token/秒与 bpc 对应）
* 13.4 视频自回归困惑度（时空 token 归一化）
* 13.5 视觉-语言任务：检索/描述/问答/指令跟随
* 13.6 泄漏检测与去重验证（近重比对评测集）
* 13.7 统计显著性与A/B 标准
* 13.8 本章小结
* 13.9 常见陷阱与错误

# chapter14.md — 安全与合规

* 14.1 开篇与学习目标
* 14.2 版权/许可证/TOS 与 robots.txt
* 14.3 PII 与敏感内容检测（文本/语音/图像/视频）
* 14.4 红队与风险分级（输入/输出/数据/模型）
* 14.5 数据下架与追溯（Data Lineage）
* 14.6 章小结
* 14.7 常见陷阱与错误

# chapter15.md — 交付与落地（Checkpoint & 蒸馏）

* 15.1 开篇与学习目标
* 15.2 交付物打包：Checkpoint、Tokenizer、离散化器版本
* 15.3 推理与离线批处理（多模 token 化/反离散化）
* 15.4 **Gemma 式 logits 蒸馏**：可行性、收益与代价
* 15.5 量化与加速（INT8/INT4、KV 压缩）
* 15.6 模型卡与数据卡发布
* 15.7 本章小结
* 15.8 常见陷阱与错误

# appendixA.md — 计算与容量估算（公式与算例）

* A.1 训练 FLOPs 与时长估算（按 token、参数、并行度）
* A.2 显存与激活开销（KV Cache/梯度/优化器）
* A.3 IO 与存储：视频/音频/图像/文本分层存储
* A.4 成本模型：1B/10B（单轮 10T token）的预算区间
* A.5 网络与通信瓶颈分析（AllReduce/AllToAll）
* A.6 经验法则速查表
* A.7 本章小结
* A.8 常见陷阱与错误

# appendixB.md — 工具链与脚手架（配置与模板）

* B.1 数据侧：抓取（yt-dlp*/API、ETL 与 Schema 约定
* B.2 离散化流水线：音频/视频/图像编码器与 RVQ 配置
* B.3 训练框架：Megatron 配置模板与日志结构
* B.4 监控/看板：指标命名与报警门限模板
* B.5 评测脚本与用例设计（数据泄漏卫士）
* B.6 发布清单与复现实验记录
* B.7 本章小结
* B.8 常见陷阱与错误

# appendixC.md — 常见故障与排障（Runbook）

* C.1 训练不收敛/震荡（学习率/归一化/精度）
* C.2 OOM 与死锁（并行切分/梯度累积/通信超时）
* C.3 数据侧异常（语言分布漂移/重复暴增/PII 泄漏）
* C.4 离散化异常（RVQ 码本崩塌/码率失衡/不同步）
* C.5 评测回归与泄漏告警（定位与回滚）
* C.6 合规投诉与数据下架（流程与证据保全）
* C.7 本章小结
* C.8 常见陷阱与错误

